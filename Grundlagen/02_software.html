<!DOCTYPE html>
<html lang="de-DE">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Software / Flashen | AskSin++</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.jpg">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/logo.jpg">
    <link rel="mask-icon" href="/logo.jpg" color="#00A4A6">
    <script>
      var _paq = [
        ["disableCookies"],
        ['setTrackerUrl', 'https://mt.psi.cx/t.php'],
        ['setSiteId', '2'],
      ];
      (function() {
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src='https://mt.psi.cx/t.js'; s.parentNode.insertBefore(g,s);
        
        function tl(ev) {
          var path = event.path || (event.composedPath && event.composedPath());
          if(!path) return;
          var target = path.find(function(el) { return el.tagName === 'A'; });
          if(!target) return;
          if(!target.href || target.href.startsWith(location.origin)) return;
          _paq.push(['trackLink', target.href, 'link']);
        }
        window.addEventListener('click', tl);
      })();
    </script>
    <meta name="description" content="">
    <meta name="theme-color" content="#00A4A6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/logo.jpg">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.f420f64c.css" as="style"><link rel="preload" href="/assets/js/app.3eb27197.js" as="script"><link rel="preload" href="/assets/js/11.f4234817.js" as="script"><link rel="preload" href="/assets/js/1.2138ff51.js" as="script"><link rel="preload" href="/assets/js/15.49899bcc.js" as="script"><link rel="preload" href="/assets/js/17.39dbc41e.js" as="script"><link rel="prefetch" href="/assets/js/10.f1f1c3d5.js"><link rel="prefetch" href="/assets/js/100.b9c126ba.js"><link rel="prefetch" href="/assets/js/101.ffdf3a99.js"><link rel="prefetch" href="/assets/js/102.20399fca.js"><link rel="prefetch" href="/assets/js/103.56cf9852.js"><link rel="prefetch" href="/assets/js/104.a8b8f351.js"><link rel="prefetch" href="/assets/js/105.a36fbee6.js"><link rel="prefetch" href="/assets/js/106.5a297b9c.js"><link rel="prefetch" href="/assets/js/107.f5d5550f.js"><link rel="prefetch" href="/assets/js/108.3bd46e93.js"><link rel="prefetch" href="/assets/js/109.88e1a734.js"><link rel="prefetch" href="/assets/js/110.75398424.js"><link rel="prefetch" href="/assets/js/111.9880d73d.js"><link rel="prefetch" href="/assets/js/112.31b7385b.js"><link rel="prefetch" href="/assets/js/113.11b5461c.js"><link rel="prefetch" href="/assets/js/114.2ce295e6.js"><link rel="prefetch" href="/assets/js/115.86605c31.js"><link rel="prefetch" href="/assets/js/116.067d9eee.js"><link rel="prefetch" href="/assets/js/12.5ee9ba71.js"><link rel="prefetch" href="/assets/js/13.4404b46b.js"><link rel="prefetch" href="/assets/js/14.c939b932.js"><link rel="prefetch" href="/assets/js/16.2df8e0de.js"><link rel="prefetch" href="/assets/js/18.0287a341.js"><link rel="prefetch" href="/assets/js/19.2d6eeb9e.js"><link rel="prefetch" href="/assets/js/20.0aef21a4.js"><link rel="prefetch" href="/assets/js/21.08bde2e9.js"><link rel="prefetch" href="/assets/js/22.31d13255.js"><link rel="prefetch" href="/assets/js/23.9876caeb.js"><link rel="prefetch" href="/assets/js/24.3dcfd0b9.js"><link rel="prefetch" href="/assets/js/25.d558d488.js"><link rel="prefetch" href="/assets/js/26.e4044f60.js"><link rel="prefetch" href="/assets/js/27.48b482bb.js"><link rel="prefetch" href="/assets/js/28.c4b6d55a.js"><link rel="prefetch" href="/assets/js/29.0083d8f3.js"><link rel="prefetch" href="/assets/js/30.9ba30df3.js"><link rel="prefetch" href="/assets/js/31.ba69307f.js"><link rel="prefetch" href="/assets/js/32.9612e0b0.js"><link rel="prefetch" href="/assets/js/33.08f3d383.js"><link rel="prefetch" href="/assets/js/34.f0b203f3.js"><link rel="prefetch" href="/assets/js/35.5c792845.js"><link rel="prefetch" href="/assets/js/36.cf1659d4.js"><link rel="prefetch" href="/assets/js/37.b4dcb45c.js"><link rel="prefetch" href="/assets/js/38.48d23d1a.js"><link rel="prefetch" href="/assets/js/39.9ee56d9c.js"><link rel="prefetch" href="/assets/js/4.a4d7a3e2.js"><link rel="prefetch" href="/assets/js/40.9345eec2.js"><link rel="prefetch" href="/assets/js/41.dffb971d.js"><link rel="prefetch" href="/assets/js/42.041350f4.js"><link rel="prefetch" href="/assets/js/43.aa1175f7.js"><link rel="prefetch" href="/assets/js/44.f95a959c.js"><link rel="prefetch" href="/assets/js/45.7091c33d.js"><link rel="prefetch" href="/assets/js/46.65810b14.js"><link rel="prefetch" href="/assets/js/47.b8bf9b7f.js"><link rel="prefetch" href="/assets/js/48.984ca100.js"><link rel="prefetch" href="/assets/js/49.2833368f.js"><link rel="prefetch" href="/assets/js/5.16797eaa.js"><link rel="prefetch" href="/assets/js/50.673e342b.js"><link rel="prefetch" href="/assets/js/51.c3e2320c.js"><link rel="prefetch" href="/assets/js/52.b21e10d8.js"><link rel="prefetch" href="/assets/js/53.103c0edb.js"><link rel="prefetch" href="/assets/js/54.96742539.js"><link rel="prefetch" href="/assets/js/55.c5f441ba.js"><link rel="prefetch" href="/assets/js/56.46a50c9f.js"><link rel="prefetch" href="/assets/js/57.1816f087.js"><link rel="prefetch" href="/assets/js/58.a12dc6ba.js"><link rel="prefetch" href="/assets/js/59.265850ae.js"><link rel="prefetch" href="/assets/js/6.1c2268d2.js"><link rel="prefetch" href="/assets/js/60.f3495ff1.js"><link rel="prefetch" href="/assets/js/61.b8880d08.js"><link rel="prefetch" href="/assets/js/62.84b8a741.js"><link rel="prefetch" href="/assets/js/63.a8a2cbed.js"><link rel="prefetch" href="/assets/js/64.33de24a0.js"><link rel="prefetch" href="/assets/js/65.568ce932.js"><link rel="prefetch" href="/assets/js/66.3532e8e6.js"><link rel="prefetch" href="/assets/js/67.ddaba80b.js"><link rel="prefetch" href="/assets/js/68.9b6963dc.js"><link rel="prefetch" href="/assets/js/69.ccd1fff7.js"><link rel="prefetch" href="/assets/js/7.2e2c9f9f.js"><link rel="prefetch" href="/assets/js/70.d96c123e.js"><link rel="prefetch" href="/assets/js/71.8f0b32bf.js"><link rel="prefetch" href="/assets/js/72.ba70d11d.js"><link rel="prefetch" href="/assets/js/73.aecff725.js"><link rel="prefetch" href="/assets/js/74.57f854f0.js"><link rel="prefetch" href="/assets/js/75.79c1af8b.js"><link rel="prefetch" href="/assets/js/76.13d6ca8d.js"><link rel="prefetch" href="/assets/js/77.246e6a85.js"><link rel="prefetch" href="/assets/js/78.05725ea1.js"><link rel="prefetch" href="/assets/js/79.f9d9c6f0.js"><link rel="prefetch" href="/assets/js/8.5a64bfea.js"><link rel="prefetch" href="/assets/js/80.03d249c9.js"><link rel="prefetch" href="/assets/js/81.fb6e0b85.js"><link rel="prefetch" href="/assets/js/82.9a2d7d66.js"><link rel="prefetch" href="/assets/js/83.9e2dc5d2.js"><link rel="prefetch" href="/assets/js/84.16e5b11f.js"><link rel="prefetch" href="/assets/js/85.36835041.js"><link rel="prefetch" href="/assets/js/86.b4330e58.js"><link rel="prefetch" href="/assets/js/87.20a670c1.js"><link rel="prefetch" href="/assets/js/88.eb69a60d.js"><link rel="prefetch" href="/assets/js/89.1cc284c5.js"><link rel="prefetch" href="/assets/js/9.3a6168ff.js"><link rel="prefetch" href="/assets/js/90.6d73e1fe.js"><link rel="prefetch" href="/assets/js/91.d140fd0f.js"><link rel="prefetch" href="/assets/js/92.be34ad53.js"><link rel="prefetch" href="/assets/js/93.8861d62b.js"><link rel="prefetch" href="/assets/js/94.6915cd8f.js"><link rel="prefetch" href="/assets/js/95.cbfdd18c.js"><link rel="prefetch" href="/assets/js/96.d4b3bb05.js"><link rel="prefetch" href="/assets/js/97.5740f7d5.js"><link rel="prefetch" href="/assets/js/98.f14540cf.js"><link rel="prefetch" href="/assets/js/99.344c0638.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.afb0a24b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f420f64c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="AskSin++" class="logo"> <span class="site-name can-hide">AskSin++</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Grundlagen/" class="nav-link router-link-active">
  Grundlagen
</a></div><div class="nav-item"><a href="/Projekte/" class="nav-link">
  Projekte
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Material" class="dropdown-title"><span class="title">Material</span> <span class="arrow down"></span></button> <button type="button" aria-label="Material" class="mobile-dropdown-title"><span class="title">Material</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Sketche/" class="nav-link">
  Sketche
</a></li><li class="dropdown-item"><!----> <a href="/Platinen/" class="nav-link">
  Platinen
</a></li><li class="dropdown-item"><!----> <a href="/Gehaeuse/" class="nav-link">
  Gehäuse
</a></li><li class="dropdown-item"><!----> <a href="/Projekte/Umbau.html" class="nav-link">
  Umbauten
</a></li><li class="dropdown-item"><!----> <a href="/rftypes/" class="nav-link">
  RF-Types
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://homematic-forum.de/forum/viewforum.php?f=76" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Forum
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.facebook.com/groups/Homematic.Freunde" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Facebook Gruppe
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://join.slack.com/t/homematicuser/shared_invite/enQtNjAzMDA0MjM3NzY1LTY2MzkzODUzODIyNGQ0YmVmZTJkNDRjN2U0MWQxNWRmNTQ0NjI4MjMyNjZjOWFmNjkyNjNiMTcwZGZmYWNlNjQ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <div class="theme-toggler" data-v-00ea32ee><a data-v-00ea32ee><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon" data-v-00ea32ee><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" data-v-00ea32ee></path></svg></a></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Grundlagen/" class="nav-link router-link-active">
  Grundlagen
</a></div><div class="nav-item"><a href="/Projekte/" class="nav-link">
  Projekte
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Material" class="dropdown-title"><span class="title">Material</span> <span class="arrow down"></span></button> <button type="button" aria-label="Material" class="mobile-dropdown-title"><span class="title">Material</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Sketche/" class="nav-link">
  Sketche
</a></li><li class="dropdown-item"><!----> <a href="/Platinen/" class="nav-link">
  Platinen
</a></li><li class="dropdown-item"><!----> <a href="/Gehaeuse/" class="nav-link">
  Gehäuse
</a></li><li class="dropdown-item"><!----> <a href="/Projekte/Umbau.html" class="nav-link">
  Umbauten
</a></li><li class="dropdown-item"><!----> <a href="/rftypes/" class="nav-link">
  RF-Types
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://homematic-forum.de/forum/viewforum.php?f=76" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Forum
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.facebook.com/groups/Homematic.Freunde" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Facebook Gruppe
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://join.slack.com/t/homematicuser/shared_invite/enQtNjAzMDA0MjM3NzY1LTY2MzkzODUzODIyNGQ0YmVmZTJkNDRjN2U0MWQxNWRmNTQ0NjI4MjMyNjZjOWFmNjkyNjNiMTcwZGZmYWNlNjQ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Grundlagen</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Grundlagen/" aria-current="page" class="sidebar-link">Einführung</a></li><li><a href="/Grundlagen/01_hardware.html" class="sidebar-link">Hardware</a></li><li><a href="/Grundlagen/02_software.html" aria-current="page" class="active sidebar-link">Software / Flashen</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Grundlagen/02_software.html#sketch-download-und-anpassen" class="sidebar-link">Sketch download und anpassen</a></li><li class="sidebar-sub-header"><a href="/Grundlagen/02_software.html#anschluss-des-ftdi-adapters" class="sidebar-link">Anschluss des FTDI Adapters</a></li><li class="sidebar-sub-header"><a href="/Grundlagen/02_software.html#platformio" class="sidebar-link">PlatformIO</a></li><li class="sidebar-sub-header"><a href="/Grundlagen/02_software.html#arduino-ide" class="sidebar-link">Arduino IDE</a></li><li class="sidebar-sub-header"><a href="/Grundlagen/02_software.html#flashen" class="sidebar-link">Flashen</a></li><li class="sidebar-sub-header"><a href="/Grundlagen/02_software.html#serieller-monitor" class="sidebar-link">Serieller Monitor</a></li><li class="sidebar-sub-header"><a href="/Grundlagen/02_software.html#ota-firmware-updates" class="sidebar-link">OTA (Firmware-Updates)</a></li></ul></li><li><a href="/Grundlagen/03_ccu.html" class="sidebar-link">Anlernen an die CCU</a></li><li><a href="/Grundlagen/04-isp.html" class="sidebar-link">In-System-Programming (ISP)</a></li><li><a href="/Grundlagen/10_weitere_infos.html" class="sidebar-link">Weitere Infos</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FAQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>STM32</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Material</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="content__default"><h1 id="software-flashen"><a href="#software-flashen" class="header-anchor">#</a> Software / Flashen</h1> <p>Die Software für den Microcontroller wird bei Arduino als <em>Sketch</em> bezeichnet.</p> <p>Da der Arduino-Pro-Mini mit einem entsprechendem Bootloader ausgeliefert wird, kann ein Sketch direkt über USB-UART Adapter
geflasht werden wie zum Beispiel dem FTDI, der den Arduino mit dem PC verbindet.</p> <h2 id="sketch-download-und-anpassen"><a href="#sketch-download-und-anpassen" class="header-anchor">#</a> Sketch download und anpassen</h2> <p>Es gibt mittlerweile viele fertige <a href="/Sketche/">Sketche</a> die je nach Aktor oder Sensor verwendet werden können.<br>
Als Beispiel wird hier der <code>HM-RC-P1</code> Paniktaster genommen.</p> <p>Der komplette Sketch ist <a href="https://github.com/pa-pa/AskSinPP/blob/master/examples/HM-RC-P1/HM-RC-P1.ino" target="_blank" rel="noopener noreferrer">HM-RC-P1.ino<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><strong>Achtung</strong>: Ein <em>&quot;Seite speichern unter&quot;</em> der Github-URL lädt die HTML-Version herunter und nicht direkt den Source-Code.
Dieser kann über den Button <code>Raw</code> aufgerufen werden: <a href="https://raw.githubusercontent.com/pa-pa/AskSinPP/master/examples/HM-LC-Bl1-FM/HM-LC-Bl1-FM.ino" target="_blank" rel="noopener noreferrer">HM-RC-P1.ino im Raw-Format<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Zudem wird nicht empfohlen <em>Notepad</em> oder gar Word zum editieren zu verwenden sondern einen <em>echten</em> Editor wie VSCode, Sublime, Atom, Notepad++, Vim, Emacs usw.</p> <h3 id="io-konfiguration"><a href="#io-konfiguration" class="header-anchor">#</a> IO-Konfiguration</h3> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// Arduino pin for the config button</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONFIG_BUTTON_PIN</span> <span class="token expression"><span class="token number">8</span></span></span>
<span class="token comment">// Arduino pins for the buttons</span>
<span class="token comment">// A0 == PIN 14</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BTN1_PIN</span> <span class="token expression"><span class="token number">14</span></span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Hier sieht man die Button Belegung und kann diese entsprechend anpassen.<br>
Für das Beispiel des Paniktasters schließen wir also den Config-Button an <code>GPIO-8</code> und <code>GND</code> sowie einen weiteren Taster an <code>GPIO-14</code> (bzw <code>A0</code>) und <code>GND</code> an.</p> <h3 id="device-konfiguration"><a href="#device-konfiguration" class="header-anchor">#</a> Device-Konfiguration</h3> <p>Der DeviceInfo Block identifiziert das neue Device:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// define all device properties</span>
<span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">DeviceInfo</span> PROGMEM devinfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span><span class="token number">0x12</span><span class="token punctuation">,</span><span class="token number">0x09</span><span class="token punctuation">,</span><span class="token number">0x01</span><span class="token punctuation">}</span><span class="token punctuation">,</span>       <span class="token comment">// Device ID</span>
    <span class="token string">&quot;JPLRCP2001&quot;</span><span class="token punctuation">,</span>           <span class="token comment">// Device Serial</span>
    <span class="token punctuation">{</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x1a</span><span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token comment">// Device Model</span>
    <span class="token number">0x11</span><span class="token punctuation">,</span>                   <span class="token comment">// Firmware Version</span>
    as<span class="token operator">::</span>DeviceType<span class="token operator">::</span>Remote<span class="token punctuation">,</span> <span class="token comment">// Device Type</span>
    <span class="token punctuation">{</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span>             <span class="token comment">// Info Bytes</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Jedes Gerät in einer HomeMatic Umgebung hat 2 eindeutige Identifikationsmerkmale:</p> <ul><li>die 10-stellige Seriennummer (wird in der WebUI in der Spalte Seriennummer in Einstellungen-&gt;Geräte angezeigt)</li> <li>die 3-Byte Geräteadresse (wird in einer Konfigurationsdatei im Dateisystem gespeichert)</li></ul> <p>Beide dürfen in einer HomeMatic-Installation nur <strong>1x vergeben</strong> werden.<br>
Ausschlaggebend für die Funk-Kommunikation ist die Geräte-Adresse.</p></div> <p>Die Geräteadresse (im Sketch als <code>Device ID</code> bezeichnet) lautet in diesem Fall <code>0x12,0x09,0x01</code>.<br>
Die Seriennummer (im Sketch als <code>Device Serial</code> bezeichnet) lautet in diesem Fall <code>JPLRCP2001</code>.</p> <p>Soll ein weiterer, auf diesen Sketch basierender HM-RC-P1 ins HomeMatic System integriert werden, verwendet man (- so mache ich es zumindest-) am besten eine fortlaufende Numerierung. 0x12, 0x09, 0x02 / JPLRCP2002.</p> <p>Wichtig: Die Seriennummer muss immer 10-stellig sein! Sie darf Buchstaben und Zahlen enthalten.</p> <h2 id="anschluss-des-ftdi-adapters"><a href="#anschluss-des-ftdi-adapters" class="header-anchor">#</a> Anschluss des FTDI Adapters</h2> <p>Um die Schaltung sehr kompakt zu halten, verzichtet man auf das Anlöten eines Steckverbinders.
Es reicht aus, wenn man die Pins des FTDI Adapters durch die Lötbohrungen steckt und während des Flash-Vorgangs verkantet.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Der FTDI muss auf 3,3V gejumpert sein da das CC1101 Funkmodul mit 5V beschädigt werden könnte.</p></div> <p><img src="/assets/img/ftdi-verkantet.9eedbe7c.jpg" alt="FTP Adapter verkantet am Arduino Pro Mini"></p> <table><thead><tr><th>PIN Arduino</th> <th>PIN FTDI</th> <th></th></tr></thead> <tbody><tr><td>DTR</td> <td>DTR</td> <td>Data Terminal Ready</td></tr> <tr><td>RX</td> <td>TX</td> <td>Datentransfer</td></tr> <tr><td>TX</td> <td>RX</td> <td>Datentransfer</td></tr> <tr><td>VCC</td> <td>VCC</td> <td>Spannung</td></tr> <tr><td></td> <td>CTS</td> <td>Wird nicht verwendet</td></tr> <tr><td>GND</td> <td>GND</td> <td>Masse</td></tr></tbody></table> <h2 id="platformio"><a href="#platformio" class="header-anchor">#</a> PlatformIO</h2> <p>PlatformIO gibt es als vollständige <a href="https://platformio.org/platformio-ide" target="_blank" rel="noopener noreferrer">Entwicklungsumgebung<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (IDE) und als <a href="https://platformio.org/install/cli" target="_blank" rel="noopener noreferrer">Command-Line-Interface<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (CLI). Wer nicht tiefer in die Programmierung einsteigen möchte ist mit der CLI-Version ausreichend bedient.</p> <p>Die nötigen Bibliotheken können über den <a href="https://docs.platformio.org/en/latest/librarymanager/" target="_blank" rel="noopener noreferrer">Library Manager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
bequem installiert werden. Er enthält neben den gebräuchlichen EnableInterrupt und Low-Power auch AskSinPP.</p> <p>Die Konfiguration des Boards kann über das Interface eingestellt werden und wird in der <code>platformio.ini</code> im
Projekt-Verzeichnis gespeichert. Diese Datei kann man sich also auch schnell selbst erstellen:</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token selector">[platformio]</span>
<span class="token constant">src_dir</span> <span class="token attr-value"><span class="token punctuation">=</span> .</span>

<span class="token selector">[env:pro8MHzatmega328]</span>
<span class="token constant">platform</span> <span class="token attr-value"><span class="token punctuation">=</span> atmelavr</span>
<span class="token constant">framework</span> <span class="token attr-value"><span class="token punctuation">=</span> arduino</span>
<span class="token constant">board</span> <span class="token attr-value"><span class="token punctuation">=</span> pro8MHzatmega328</span>
<span class="token constant">monitor_speed</span> <span class="token attr-value"><span class="token punctuation">=</span> 57600</span>

<span class="token constant">lib_deps</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
  AskSinPP
  EnableInterrupt
  Low-Power
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Einige Projekte bringen bereits eine <code>platformio.ini</code> mit und man kann mit <code>platformio run -t upload</code> den Code
kompilieren und direkt flashen ohne weitere Einstellungen vornehmen zu müssen.</p> <p>Manchmal kommt es vor, dass PlatformIO versucht ein falsches USB-Gerät anzusprechen. Hier kann mit <code>platformio device list</code>
der Pfad des FTDI ermittelt werden. Dieser Pfad wird als Argument bei <code>run</code> übergeben.
Bsp.: <code>platformio run -t upload --upload-port /dev/ttyUSB0</code></p> <h2 id="arduino-ide"><a href="#arduino-ide" class="header-anchor">#</a> Arduino IDE</h2> <p>Die <a href="https://www.arduino.cc/en/Main/Software" target="_blank" rel="noopener noreferrer">Arduino IDE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ist die gebräuchlichste
PC Software für den Umgang mit dem Arduino.</p> <h3 id="bibliothek-einbinden"><a href="#bibliothek-einbinden" class="header-anchor">#</a> Bibliothek einbinden</h3> <p>Damit die im Sketch verwendeten Bibliotheken zur Verfügung stehen, müssen diese eingebunden werden:</p> <ul><li>AskSinPP</li> <li>EnableInterrupt</li> <li>Low-Power</li></ul> <p>Die Release-Branches der AskSinPP (V#) sind dazu gedacht, eine stabile Basis für Geräte zu sein, ohne die Weiterentwicklung einzuschränken.</p> <p>Bitte nutzt den V4 Branch für Eure Geräte.</p> <p>Der Master-Zweig wird für die aktive Entwicklung verwendet und kann instabil sein.</p> <p>Ausnahme: Einige Geräte wie HB-UNI-Sen-WEA oder HB-UNI-Sensor1 nutzen neuere Features und benötigen deswegen den Master-branch.
Dies sollte in der Readme zum jeweiligen Gerät dokumentiert sein.</p> <p>Die AskSinPP Bibliothek kann als ZIP-Datei für den <a href="https://codeload.github.com/pa-pa/AskSinPP/zip/V4" target="_blank" rel="noopener noreferrer">V4 Release-Branch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> bzw. für den <a href="https://codeload.github.com/pa-pa/AskSinPP/zip/master" target="_blank" rel="noopener noreferrer">Master-branch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> heruntergeladen werden.</p> <p>Anschließend geht man in der Arduino IDE auf <code>Sketch &gt; Bibliothek einbinden &gt; .ZIP-Bibliothek hinzufügen</code>
und wählt die ZIP-Datei aus.</p> <p>EnableInterrupt und Low-Power wird über <code>Sketch &gt; Bibliothek einbinden &gt; Bibliotheken verwalten</code>
gesucht und installiert.</p> <h3 id="board-einstellen"><a href="#board-einstellen" class="header-anchor">#</a> Board einstellen</h3> <ul><li>Board: <code>Arduino Pro or Pro Mini</code></li> <li>Prozessor: <code>ATmega328P (3.3V, 8 MHz)</code></li> <li>Port: COM-Port des FTDI Adapters</li></ul> <h2 id="flashen"><a href="#flashen" class="header-anchor">#</a> Flashen</h2> <p>Sind die Werte angepasst, kann der Programmcode kompiliert und an den Mikrocontroller
übertragen werden. In der Arduino IDE heißt dieser Vorgang <code>Sketch hochladen</code>
und bei PlatformIO <code>upload</code>.</p> <p>Unter Device-Model wird ein zweistelliger Hexwert verwendet. Dieser Wert kann mehrfach vorkommen.
Durch diesen Wert wird das Format der Kommunikation vom und zum Gerät beschrieben. Weitere
von diesem Wert abhängigen Informationen sind im WebGUI sichtbar. So wird das Geräte-Icon
und die Darstellung der vom Gerät übertragenen Werte über die Device-Model referenziert.</p> <p>Für die HM-Geräte und 1:1 Nachbauten sind die Device-Model in der CCU vorhanden. Für eigene
Geräte (Homebrew) werden sie z.B. über Addons hinzugefügt.</p> <p>Im Beispiel ist das Device-Model <code>{0x00,0x1a}</code>. Über die Liste <a href="/rftypes/">RF-Types</a> findet man, dass dieses
Device-Model <code>0x001A</code> der FunkPankiHandsender HM-RC-P1 ist, also ein Original HM-Gerät
und damit Icon und Beschreibung der Darstellung in der CCU schon vorhanden sind.</p> <p>Das Feld Firmware beinhaltet einen HEX-Wert, der in der Web-GUI als zwei Ziffeern angezeigt wird.
Aus <code>0x11</code> wird dann &quot;Firmware Version 1.1&quot;. Wenn auf die CCU eine höhere Firmware eingespielt wurde kann diese bei OTA-fähigen Geräten dann upgedatet werden.</p> <p>In der über das Device-Model referenzierten Konfiguration kann auch eine von der Firmwareversion
abhängige Funktionalität enthalten sein, um etwa Varianten ab einer bestimmten Version zu ermöglichen.</p> <p>Der Device-Type beschreibt eine Klasse an Geräten. So können etwa Taster mit unterschiedlicher Anzahl
an Tasten (und damit unterschiedlichem Device-Model) an anderen Stellen wieder gemeinschaftlich
behandelt werden.</p> <p>Und letzlich gibt des noch die zweistellige HEX-Angabe Device-Info, wo weitere Details des Gerätes
beschrieben werden.</p> <h2 id="serieller-monitor"><a href="#serieller-monitor" class="header-anchor">#</a> Serieller Monitor</h2> <p>Der Arduino verfügt über eine Debug-Ausgabe die vom PC über den <code>seriellen Monitor</code>
abgerufen werden kann:</p> <ul><li>Arduino IDE: Menü &gt; Werkzeuge &gt; serieller Monitor</li> <li>PlatformIO CLI: <code>platformio device monitor</code></li></ul> <p>Aus dem Sketch kann man die verwendete Baudrate ablesen:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">DINIT</span><span class="token punctuation">(</span><span class="token number">57600</span><span class="token punctuation">,</span>ASKSIN_PLUS_PLUS_IDENTIFIER<span class="token punctuation">)</span><span class="token punctuation">;</span>
  sdev<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>hal<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Hier also <strong>57600 Baud</strong>. Diese muss beim Verbindungsaufbau übereinstimmen, damit man
nicht nur wirre Zeichen erhält. Es ist zu empfehlen nach jedem Flashvorgang einen Blick auf
die Ausgaben zu werfen.
Für den Fall, dass man mit <strong>115200</strong> Baud eine Verbindung/lebare Zeichen bekommt, verwendet man eine 16MHz Pro Mini.
Achtung die haben meistens auch <strong>5V</strong> VCC und zerstören potentiell das CC1101 Funkmodul.</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token comment"># Version</span>
AskSin++ V4.1.0 (Aug 25 2019 00:08:04)
<span class="token comment"># Speicherbereich für Peerings und deren Parameter</span>
Address Space: 32 - 870
<span class="token comment"># Funkmodul Init und Version</span>
CC init1
CC Version: 14
<span class="token comment"># Device ist gebootet</span>
 - ready
<span class="token comment"># Device-ID und Serial (wird nicht immer ausgegeben)</span>
ID: 120901  Serial: JPLRCP2001
<span class="token comment"># Funkverkehr:  &lt;- ausgehend;  -&gt; eingehend</span>
&lt;- 0F 01 86 10 0108F2 000000 06 01 00 00 00 00  - 7528
&lt;- 0F 02 86 10 0108F2 000000 06 02 00 00 00 00  - 7626
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Weiteres zum <a href="/Grundlagen/FAQ/Debugging.html">Debugging</a> in den FAQ.</p> <h2 id="ota-firmware-updates"><a href="#ota-firmware-updates" class="header-anchor">#</a> OTA (Firmware-Updates)</h2> <p>Geräte mit AskSin++ können über die CCU sowie über FHEM mit neuer Software bespielt werden.
Das funktioniert wie bei gewöhnlichen HomeMatic Geräten über die &quot;Geräte-Firmware&quot;-Übersicht.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>OTA-Updates über die CCU dürfen nur bei eigenen Gerätedefinitionen gemacht werden, nicht bei Geräten,
die offiziell existieren.</p> <ul><li>ein unabsichtliches Flashen von echten HomeMatic-Geräten mit der AskSin++-Firmware wird diese <strong>unbrauchbar</strong> machen</li> <li>viele offizielle Geräte haben nicht die nötigen Parameter und Einstellungen in der Gerätedefinition für OTA-Updates oder nutzen andere Mikrocontroller</li></ul></div> <h3 id="bootloader-erstellen"><a href="#bootloader-erstellen" class="header-anchor">#</a> Bootloader erstellen</h3> <p>Um die Geräte per OTA-Update mit Software versorgen zu können, ist ein spezieller Bootloader nötig, der auf die Geräte aufgespielt werden muss.
Das kann bei den üblichen Arduino Pro Minis leider nicht über die serielle Schnittstelle (FTDI) erfolgen, sondern muss mit einem AVR ISP-Programmer gemacht werden.
Durch das Installieren des OTA-Bootloaders wird auch der Arduino-Bootloader ersetzt, was zur Folge hat, dass eine Programmierung der Arduinos nur noch per ISP (und natürlich per OTA) möglich ist.</p> <p>Damit die Firmware nicht für jedes Gerät individuell gebaut werden muss, verschieben sich die Geräteinformationen (Seriennummer, Geräteadresse) in den Bootloader.
Der Bootloader wird also &quot;personalisiert&quot; für jedes Gerät erstellt und geflasht. Die Firmware kann dann auf alle (baugleichen) Sensoren über die CCU übertragen werden.</p> <p>Im Sketch muss das &quot;<code>USE_OTA_BOOTLOADER</code>&quot; einkommentiert werden. Dieses sorgt dafür, dass die Firmware die Geräteinformationen aus dem Bootloader liest:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// define this to read the device id, serial and device type from bootloader section</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">USE_OTA_BOOTLOADER</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Mit dieser Änderung wird jetzt eine neue Firmware gebaut und wir benötigen das resultierende .hex-File.<br>
In der Arduino IDE kann die Firmware über Sketch-&gt;Kompilierte Binärdatei exportieren gespeichert werden.<br>
Bei PlatformIO findet sich diese in <code>Projektordner/.pio/build/pro8MHzatmega328/firmware.hex</code>.</p> <p>Nun benötigen wir den Bootloader selbst:<br>
Dieser ist im AskSin++-Git enthalten und kann von uns entweder per <code>git clone https://github.com/pa-pa/AskSinPP</code> oder als <a href="https://github.com/pa-pa/AskSinPP/archive/master.zip" target="_blank" rel="noopener noreferrer">.zip Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> runtergeladen werden. Im Ordner <code>bootloader/avr/</code> befindet sich die <code>makeota.html</code>.<br>
Diese Datei kann mit einem Webbrowser geöffnet werden und erstellt uns einen Bootloader mit den gewünschten Parametern.
<img src="/assets/img/makeotahtml.dc4d06f3.png" alt="makeota.html"></p> <ul><li><strong>MCU Type</strong> bleibt auf ATmega328 (für die normalen Arduino ProMini)</li> <li><strong>Device Model</strong> ist der Geräte-Typ, also z.B. FA01</li> <li><strong>HM ID</strong> ist die Geräteadresse (3 Bytes), z.B. 210001</li> <li><strong>HM Serial</strong> ist die Seriennummer, z.B. ASKS210001</li> <li><strong>Config string</strong> kann zusätzliche Konfigurationseinstellungen für die Firmware speichern, kann auf 0 gelassen werden.</li></ul> <p>Unter <strong>Firmware</strong> wird dann unsere .hex-Datei mit der gewünschten Firmware hochgeladen.
Nach einem Klick auf &quot;Create Bootloader&quot; bekommen wir dann eine .hex-Datei mit der HM Serial als Namen heruntergeladen.<br>
Diese Datei enthält den Bootloader, die Konfiguration sowie unsere Firmware und kann so 1:1 auf den AVR geflashed werden.</p> <h3 id="bootloader-flashen"><a href="#bootloader-flashen" class="header-anchor">#</a> Bootloader flashen</h3> <p>Die Firmware kann nun auf den AVR geflashed werden. Dazu können verschiedene Tools genutzt werden.</p> <p>Über die Konsole erfolgt das Flashen folgendermaßen:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>avrdude -p m328p -c stk500v2 -P /dev/ttyUSB0 -U lfuse:w:0xE2:m -U hfuse:w:0xD0:m
avrdude -p m328p -c stk500v2 -P /dev/ttyUSB0 -V -U flash:w:ASKS21001.hex
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Die Parameter -c (Programmieradaptertyp) und -P (Port) müssen entsprechend für den genutzten AVR ISP-Programmer abgeändert werden.
Die Fuses nutzen den internen 8 MHz RC-Oszillator, deaktivieren die Brown-Out Erkennung, deaktivieren das Löschen des EEPROM beim Flashen und konfigurieren den Resetvektor des Bootloaders.</p> <p>Nach dem Flashen funktioniert das Gerät wie gewohnt und kann an die CCU angelernt werden.</p> <h3 id="firmware-fur-ccu-verpacken"><a href="#firmware-fur-ccu-verpacken" class="header-anchor">#</a> Firmware für CCU verpacken</h3> <p>Um nun eine neue Firmware zu übertragen, wird wieder eine .hex-Datei mit der neuen Firmware erstellt.<br>
Hierbei ist darauf zu achten, dass der &quot;Firmware Version&quot;-Parameter im DeviceInfo struct auf die neue Firmwareversion aktualisiert wird:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>    <span class="token number">0x12</span><span class="token punctuation">,</span>                   <span class="token comment">// Firmware Version</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>0x12 ist die Version 1.2, 0x34 wäre Version 3.4.</p> <p>Das Tool prepota.sh im Bootloader-Ordner kann nun die .hex-Datei in eine .eq3-Datei umwandeln.<br>
Hierzu wird auf der Konsole das Script prepota.sh genutzt:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./prepota.sh neueFirmwareVersion1.2.hex
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Unter Windows kann dies entweder im Windows 10 Subsystem for Linux oder über Cygwin (bash, sed) erfolgen. Unter Linux und Mac sollten alle erforderlichen Abhängigkeiten bereits vorhanden sein.
Wenn der Download des AskSin++-Quelltextes als .zip-Datei erfolgt ist, kann es evtl. nötig sein, die Datei als Ausführbar zu markieren.
Das kann mit <code>chmod +x prepota.sh</code> erledigt werden.
Das Tool ist relativ langsam, Laufzeiten von 30 Sekunden können durchaus auftreten.</p> <p>Ein Firmware-Update für die CCU besteht aus 3 Dateien:</p> <ul><li>firmware_aktuellesDatum.eq3</li> <li>changelog.txt</li> <li>info</li></ul> <p>Diese 3 Dateien werden als .tar.gz-Archiv verpackt.</p> <p>Unter Windows lässt sich das .tar.gz-Archiv mit dem Tool 7-Zip erstellen.<br>
Die Datei info (ohne Dateiendung!) enthält folgende Informationen:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>TypeCode=64001
Name=HB-Sen-Env-I
CCUFirmwareVersionMin=2.27.0
CCU3FirmwareVersionMin=3.27.0
FirmwareVersion=1.2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>TypeCode ist die Device Model ID (in diesem Beispiel 0xFA01) allerdings in <a href="https://www.google.com/search?q=0xFA01+in+decimal" target="_blank" rel="noopener noreferrer">dezimaler Schreibweise<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>Name ist der genaue Name (auf Groß- und Kleinschreibung achten!) aus der .xml-Gerätedefinition.</li> <li>CCU und CCU3FirmwareVersionMin ist die minimale Version der CCU-Firmware, die benötigt wird.</li> <li>FirmwareVersion ist die Version der Firmware, die in diesem Ordner enthalten ist.</li></ul> <p>Die Datei sollte mit Unix-Zeichenenden (LF, \n) gespeichert werden.<br>
Die changelog.txt enthält natürlichen Text mit Informationen über diese Firmware-Version.</p> <p>Die fertige .tar.gz-Datei mit der Firmware muss folgendermaßen aussehen:<br> <img src="/assets/img/firmwareupdate.f88237d6.png" alt=".tar.gz Datei mit 3 Dateien"></p> <h3 id="ota-update-starten"><a href="#ota-update-starten" class="header-anchor">#</a> OTA-Update starten</h3> <p>Ein Firmware-Update kann wie üblich über die CCU gestartet werden.
Nach dem Klick auf &quot;Update&quot; beim entsprechenden Gerät wird zunächst eine Fehlermeldung auftreten.
Das Update wurde dennoch vorgemerkt. Durch einen Druck auf den Gerätetaster am entsprechenden Gerät wird das Update dann gestartet.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/AskSinPP/asksinpp-web/edit/master/Grundlagen/02_software.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Letztes Update:</span> <span class="time">8.4.2021, 21:14:37</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Grundlagen/01_hardware.html" class="prev">
        Hardware
      </a></span> <span class="next"><a href="/Grundlagen/03_ccu.html">
        Anlernen an die CCU
      </a>
      →
    </span></p></div> <div class="page_bottom"><a href="/impressum.html">Impressum</a></div></main></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.3eb27197.js" defer></script><script src="/assets/js/11.f4234817.js" defer></script><script src="/assets/js/1.2138ff51.js" defer></script><script src="/assets/js/15.49899bcc.js" defer></script><script src="/assets/js/17.39dbc41e.js" defer></script>
  </body>
</html>
